# GAT_RA å·¥ç¨‹æ–‡æ¡£ï¼ˆåˆå¹¶ç‰ˆï¼‰

---

# ä¸€ã€FL åŠŸèƒ½ä¸ Bug ä¿®å¤

## 1.1 FL Bugï¼šç´¯åŠ å™¨åˆå§‹åŒ–é”™è¯¯ï¼ˆå·²ä¿®å¤ï¼‰

**ä½ç½®**: `PPO_brain_AC.py` ç¬¬536-561è¡Œ

**é—®é¢˜**: ç´¯åŠ å™¨ç”¨éšæœºæ•°åˆå§‹åŒ–ï¼Œåº”ä»é›¶å¼€å§‹ç´¯åŠ ã€‚
```python
# âŒ é”™è¯¯
w_1_mean = np.random.normal(0, sigma, [self.s_dim, n_hidden_1])
# âœ… æ­£ç¡®
w_1_mean = np.zeros([self.s_dim, n_hidden_1])
```

**å½±å“**: å¯¼è‡´è½¯èšåˆã€åˆ†å±‚èšåˆã€è¯­ä¹‰åŠ æƒå‡æ— æ•ˆï¼›åªæœ‰ Adapt æœ‰æ•ˆï¼ˆå› åªæ”¹èšåˆæ—¶æœºï¼Œä¸ä¾èµ–ç´¯åŠ å™¨ï¼‰ã€‚

**éªŒè¯**: ä¿®å¤åè¾“å‡ºç¤ºä¾‹ï¼š
```
ğŸ“Š èšåˆéªŒè¯: w_1_meanèŒƒå›´=[-0.4689, 0.4689], å‡å€¼=-0.0011
ğŸ’¡ è½¯èšåˆéªŒè¯ (Agent 0): w_1å˜åŒ–=0.000019, ç¡¬æ›¿æ¢å˜åŒ–=0.000026, è½¯èšåˆæ¯”ä¾‹=0.70
```

---

## 1.2 è‡ªé€‚åº”èšåˆé¢‘ç‡ï¼ˆAdaptï¼‰

**ç”¨æ³•**: `--fl_adaptive_interval`

- æ—©æœŸï¼ˆ0â€“30%ï¼‰ï¼šæ¯ `target_average_step * 2` æ­¥èšåˆ
- ä¸­æœŸï¼ˆ30â€“70%ï¼‰ï¼šæ¯ `target_average_step` æ­¥èšåˆ
- åæœŸï¼ˆ70â€“90%ï¼‰ï¼šæ¯ `target_average_step // 2` æ­¥èšåˆ

## 1.3 è½¯èšåˆï¼ˆSoft Aggregationï¼‰

**ç”¨æ³•**: `--fl_soft_aggregation --fl_aggregation_weight 0.7`

- 1.0ï¼šç¡¬æ›¿æ¢ï¼›0.7ï¼š70% èšåˆ + 30% æœ¬åœ°ï¼ˆæ¨èï¼‰ï¼›0.5ï¼šå¹³è¡¡ï¼›0.3ï¼šè½»åº¦èšåˆ

## 1.4 åˆ†å±‚è”é‚¦èšåˆï¼ˆLayer-wiseï¼‰

**ç”¨æ³•**: `--fl_layer_wise`

- **èšåˆ**: w_1, b_1, w_2, b_2ï¼ˆç‰¹å¾æå–å±‚ï¼‰
- **ä¸èšåˆ**: w_RB, w_power_alpha, w_rho_alpha ç­‰ï¼ˆå†³ç­–å±‚ï¼‰

## 1.5 è¯­ä¹‰æ„ŸçŸ¥åŠ æƒï¼ˆSemantic-Aware Weightingï¼‰

**ç”¨æ³•**: `--fl_semantic_weighting --fl_semantic_temperature 0.5`

- ç”¨ SEEï¼ˆçŠ¶æ€å‘é‡ index -4ï¼‰ç®—æƒé‡ï¼Œæ›¿ä»£ success_rate
- æ¸©åº¦è¶Šå°ï¼Œå¥½æ™ºèƒ½ä½“æƒé‡è¶Šå¤§ï¼›æ¨è 0.3â€“0.5

## 1.6 TensorBoard æ—¥å¿—å‘½å

æ ¼å¼ï¼š`SEE_MAPPO_{æ¨¡å¼}_Amax{}_semB{}_UAV{}_RB{}_lr{}_FL{}_max{}[_Adapt][_S{}][_Layer][_Sem{}]`

- Adaptï¼šè‡ªé€‚åº”èšåˆï¼›S70ï¼šè½¯èšåˆ 0.7ï¼›Layerï¼šåˆ†å±‚ï¼›Sem50ï¼šè¯­ä¹‰åŠ æƒ T=0.5

## 1.7 éªŒè¯å‘½ä»¤

```bash
# è½¯èšåˆ
python main_PPO_AC.py --Do_FL --fl_soft_aggregation --fl_aggregation_weight 0.7 --n_episode 5 --n_veh 4 --target_average_step 2
# åˆ†å±‚
python main_PPO_AC.py --Do_FL --fl_layer_wise --n_episode 5 --n_veh 4 --target_average_step 2
# è¯­ä¹‰åŠ æƒ
python main_PPO_AC.py --Do_FL --fl_layer_wise --fl_semantic_weighting --fl_semantic_temperature 0.3 --n_episode 5 --n_veh 4 --target_average_step 2
```

## 1.8 æ¨è FL ç»„åˆ

```bash
python main_PPO_AC.py --Do_FL --fl_layer_wise --fl_semantic_weighting --fl_semantic_temperature 0.3 \
  --fl_soft_aggregation --fl_aggregation_weight 0.8 --fl_adaptive_interval --n_episode 1000 --n_veh 6
```

---

# äºŒã€Meta å­¦ä¹ 

## 2.1 åŸå§‹ vs æ”¹è¿›ç‰ˆ

- **åŸå§‹**: `meta_brain_PPO.py`, `meta_train_PPO_AC.py`
- **æ”¹è¿›**: `meta_brain_PPO_improved.py`, `meta_train_PPO_AC_improved.py`

## 2.2 Meta è®­ç»ƒå‘½ä»¤

```bash
python meta_train_PPO_AC.py --meta_episode 500 --lr_meta_a 3e-4 --lr_meta_c 1e-3 --n_veh_list 2,4,8 --meta_batch_size 64
python meta_train_PPO_AC_improved.py --meta_episode 500 --lr_meta_a 3e-4 --lr_meta_c 1e-3 --n_veh_list 2,4,8 --meta_batch_size 64
```

## 2.3 Meta ä¼˜åŒ–ç‚¹ï¼ˆåˆ—ä¸¾ï¼‰

1. ä»»åŠ¡é‡‡æ ·ï¼šä»»åŠ¡ç‰¹å®šé‡‡æ ·ã€é‡è¦æ€§é‡‡æ ·ã€è¯¾ç¨‹å­¦ä¹   
2. ä»»åŠ¡æƒé‡ï¼šæŒ‰éš¾åº¦/æ€§èƒ½åˆ†é…æƒé‡  
3. å…ƒå­¦ä¹ æ›´æ–°ï¼šå¤šæ­¥é€‚åº”ã€MAML é£æ ¼å†…/å¤–å¾ªç¯  
4. å­¦ä¹ ç‡ï¼šè¡°å‡ã€warm-up  
5. å¥–åŠ±å½’ä¸€åŒ–ï¼šä»»åŠ¡ç‰¹å®šã€æ»‘åŠ¨çª—å£  
6. æ¢¯åº¦ï¼šè£å‰ªã€ç›‘æ§  
7. æ•°æ®ï¼šä»»åŠ¡å¤šæ ·æ€§ã€çŠ¶æ€/åŠ¨ä½œå¢å¼º  
8. æ¨¡å‹ï¼šå®šæœŸæ£€æŸ¥ç‚¹ã€æœ€ä½³æ¨¡å‹ã€æ—©åœ  
9. ç›‘æ§ï¼šTensorBoardã€ä»»åŠ¡çº§æŒ‡æ ‡  
10. æ‰¹å¤„ç†ï¼šåŠ¨æ€ batchã€é‡è¦æ€§é‡‡æ ·  
11. ç®—æ³•ï¼šæ ‡å‡† MAMLã€Reptile  
12. å¥–åŠ±ï¼šä»»åŠ¡ç‰¹å®šã€å¤šç›®æ ‡  
13. ç½‘ç»œï¼šä»»åŠ¡åµŒå…¥ã€æ¡ä»¶ç½‘ç»œ  
14. æ•ˆç‡ï¼šä»»åŠ¡å¹¶è¡Œã€ç¼“å­˜  
15. æ³›åŒ–ï¼šæ›´å¤šä»»åŠ¡ã€åŸŸéšæœºåŒ–  
16. æ•°å€¼ï¼šé²æ£’å½’ä¸€åŒ–ã€NaN æ£€æµ‹  
17. è¶…å‚ï¼šæœç´¢ã€è‡ªé€‚åº”  
18. è¯„ä¼°ï¼šéªŒè¯é›†ã€å¤šæŒ‡æ ‡  

---

# ä¸‰ã€ä¸‰ç§ç®—æ³•è®­ç»ƒå‘½ä»¤

```bash
# RL
python main_PPO_AC.py --n_veh 6 --n_RB 10 --n_episode 1000

# MRLï¼ˆå…ƒå­¦ä¹ ï¼‰
python main_PPO_AC.py --Do_meta --n_veh 6 --n_RB 10 --n_episode 1000

# FRLï¼ˆè”é‚¦ï¼‰
python main_PPO_AC.py --Do_FL --n_veh 6 --n_RB 10 --n_episode 1000 --target_average_step 100

# MFRLï¼ˆå…ƒå­¦ä¹ +è”é‚¦ï¼‰
python main_PPO_AC.py --Do_meta --Do_FL --n_veh 6 --n_RB 10 --n_episode 1000 --target_average_step 100
```

---

# å››ã€ç®—æ³•å¯¹æ¯”ä¸ç¨³å®šæ€§

## 4.1 å…¸å‹ç»“æœï¼ˆUAV6, RB10, lr=1e-6ï¼‰

| æŒ‡æ ‡       | FRL   | MFRL  | MRL   | å¤‡æ³¨           |
|------------|-------|-------|-------|----------------|
| æœ€ç»ˆå¥–åŠ±   | å¤šå˜  | 3.78  | 3.84  | MRL ç•¥é«˜       |
| å¹³å‡å¥–åŠ±   | -     | 2.84  | 2.75  | MFRL ç•¥é«˜      |
| å¹³å‡ç›¸ä¼¼åº¦ | -     | 0.81  | 0.82  | æ¥è¿‘           |
| å¹³å‡æˆåŠŸç‡ | -     | 0.86  | 0.86  | æ¥è¿‘           |

## 4.2 ç¨³å®šæ€§ï¼ˆå˜å¼‚ç³»æ•° CVï¼Œè¶Šå°è¶Šç¨³å®šï¼‰

- MFRL vs FRLï¼šMFRL æ›´ç¨³å®šï¼ˆçº¦ +17â€“25%ï¼‰  
- MFRL vs MRLï¼šæ¥è¿‘ï¼ˆå·®å¼‚ &lt;10%ï¼‰  
- FL ä¸ Meta ç»“åˆï¼ˆMFRLï¼‰æ—¶ï¼Œç¨³å®šæ€§æ¥è¿‘ MRLä¸”å…·åä½œä¼˜åŠ¿  

## 4.3 MFRL vs MRL

- MFRL å¹³å‡å¥–åŠ±ç•¥é«˜ï¼Œæœ€ç»ˆå¥–åŠ±ç•¥ä½äº MRLï¼ˆ&lt;2%ï¼‰  
- å¯èƒ½åŸå› ï¼šèšåˆé¢‘ç‡/ç­–ç•¥ã€å…ƒå­¦ä¹ ä¸ FL çš„å¹³è¡¡  
- æ”¹è¿›æ–¹å‘ï¼šAdaptã€è½¯èšåˆã€åˆ†å±‚ã€è¯­ä¹‰åŠ æƒï¼ˆè§ç¬¬ä¸€ç« ï¼‰  

---

# äº”ã€MFRL æ”¹è¿›å»ºè®®ï¼ˆç®€è¦ï¼‰

1. **èšåˆç­–ç•¥**: è‡ªé€‚åº”é¢‘ç‡ï¼ˆAdaptï¼‰ã€è½¯èšåˆã€åˆ†å±‚èšåˆã€è¯­ä¹‰åŠ æƒï¼ˆå·²å®ç°ï¼‰  
2. **èšåˆæƒé‡**: å¤šæŒ‡æ ‡åŠ æƒã€æ¸©åº¦ç¼©æ”¾ã€æŒ‡æ•°å¹³æ»‘  
3. **é€‰æ‹©æ€§èšåˆ**: åˆ†å±‚èšåˆã€æ¢¯åº¦èšåˆ  
4. **å…ƒå­¦ä¹ ä¸ FL å¹³è¡¡**: é˜¶æ®µåŒ–è®­ç»ƒã€èšåˆåå­¦ä¹ ç‡è¡°å‡  
5. **æ•°å€¼**: æ¢¯åº¦è£å‰ªã€å‚æ•°å½’ä¸€åŒ–  
6. **è§¦å‘æ¡ä»¶**: æ€§èƒ½å·®å¼‚è§¦å‘ã€æ”¶æ•›æ£€æµ‹  

---

# å…­ã€è¿ç»­åŠ¨ä½œä¸ Beta åˆ†å¸ƒ

- Powerã€rho å‡ç”¨ **Beta åˆ†å¸ƒ**ï¼Œè¾“å‡º [0,1]ï¼›power å†æ˜ å°„åˆ° [âˆ’bound, bound]  
- å®ç°è§ `PPO_brain_AC.py` / `meta_brain_PPO.py`ï¼š`w_power_alpha/beta`, `w_rho_alpha/beta`ï¼Œ`tf.distributions.Beta`ï¼Œ`softplus + 1.0` ä¿è¯ Î±,Î²&gt;1  

---

# ä¸ƒã€æ•…éšœæ’é™¤ï¼ˆé€šç”¨ï¼‰

- **OOM**: å‡å° batch_sizeã€inner_loop_steps  
- **NaN**: é™å­¦ä¹ ç‡ã€æ¢¯åº¦è£å‰ªã€æ£€æŸ¥å½’ä¸€åŒ–  
- **æ”¶æ•›æ…¢**: è°ƒå­¦ä¹ ç‡ã€ä»»åŠ¡æƒé‡ã€èšåˆé—´éš”  
- **è½¯èšåˆ/åˆ†å±‚/è¯­ä¹‰åŠ æƒæ— æ•ˆ**: ç¡®è®¤ç´¯åŠ å™¨å·²æ”¹ä¸º `np.zeros` åˆå§‹åŒ–ï¼ˆè§ 1.1ï¼‰  

---

**æ–‡æ¡£åˆå¹¶è¯´æ˜**: åŸ `FL_*`ã€`LAYER_WISE_*`ã€`SEMANTIC_*`ã€`META_*`ã€`mfrl_*`ã€`meta_learning_*`ã€`LOG_NAME_*`ã€`stability_*`ã€`algorithm_*`ã€`training_*`ã€`distribution_*` ç­‰ md å†…å®¹å·²åˆå¹¶å…¥æœ¬æ–‡æ¡£ï¼Œå…¶ä½™ md å·²åˆ é™¤ï¼Œåç»­ä»…ç»´æŠ¤ `DOCS.md`ã€‚
