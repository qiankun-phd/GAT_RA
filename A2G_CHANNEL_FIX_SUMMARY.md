# A2G信道模型调整总结

**调整时间**: 2025-12-11

---

## 🎯 目标

调整A2G信道模型，使SINR达到原始环境水平（平均40.83 dB）

---

## 🔍 问题诊断

### 原始问题

1. **SINR过低**
   - 当前环境：平均-7.78 dB
   - 原始环境：平均40.83 dB
   - **差异：48.61 dB**

2. **路径损耗过高**
   - 当前环境：126-146 dB
   - 原始环境：65-90 dB
   - **差异：60+ dB**

### 根本原因

1. **路径损耗公式不同**
   - 原始环境：`PL = 32.4 + 20*log10(fc) + 31.9*log10(d_3d)`
   - 当前环境：`PL = FSPL + p_los*eta_LoS + (1-p_los)*eta_NLoS`
   - FSPL公式导致路径损耗更大

2. **区域大小不同**
   - 原始环境：25m x 25m
   - 当前环境：1000m x 1000m（默认）
   - UAV距离基站太远，路径损耗巨大

---

## ✅ 调整方案

### 调整1: 路径损耗公式

**文件**: `Environment_marl_indoor.py:63-89`

**修改前**:
```python
# Free space path loss
fsp_loss = 20 * np.log10(d_3d) + 20 * np.log10(np.array(self.fc) * 1e9) + 20 * np.log10(4 * math.pi / self.c)
# Expected path loss
path_loss[0, k] = fsp_loss[k] + p_los * self.eta_LoS + (1 - p_los) * self.eta_NLoS
```

**修改后**:
```python
# Use original BSchannels formula for compatibility
# PL = 32.4 + 20*log10(fc) + 31.9*log10(d_3d)
for k in range(len(self.fc)):
    path_loss[0, k] = 32.4 + 20 * np.log10(self.fc[k]) + 31.9 * np.log10(d_3d)
```

**理由**: 使用与原始环境相同的路径损耗公式，确保SINR水平一致

### 调整2: 区域大小

**文件**: `Environment_marl_indoor.py:193`

**修改前**:
```python
area_size=1000.0, height_min=50.0, height_max=200.0
```

**修改后**:
```python
area_size=25.0, height_min=1.5, height_max=1.5
```

**理由**: 
- 匹配原始环境的25m x 25m区域
- 高度设为1.5m（匹配原始环境的车辆高度）

---

## 📊 调整效果

### SINR对比

| 指标 | 调整前 | 调整后 | 原始环境 | 状态 |
|------|--------|--------|---------|------|
| **最小值** | -30.99 dB | 11.39 dB | 3.95 dB | ✅ 改善 |
| **最大值** | 32.31 dB | 64.54 dB | 83.14 dB | ✅ 改善 |
| **平均值** | -7.78 dB | **35.02 dB** | 40.83 dB | ✅ 接近 |
| **中位数** | -10.66 dB | 33.20 dB | 41.21 dB | ✅ 接近 |
| **阈值通过率** | 15-17% | **100%** | 100% | ✅ 匹配 |

### 关键改进

1. **SINR平均值提升**
   - 从-7.78 dB提升到35.02 dB
   - 接近原始环境的40.83 dB
   - **提升42.8 dB**

2. **阈值通过率**
   - 从15-17%提升到100%
   - 与原始环境一致

3. **路径损耗**
   - 从126-146 dB降低到65-90 dB
   - 与原始环境一致

---

## 🔧 技术细节

### 路径损耗公式对比

**原始环境 (BSchannels)**:
```
PL = 32.4 + 20*log10(fc) + 31.9*log10(d_3d)
```

**当前环境 (调整后)**:
```
PL = 32.4 + 20*log10(fc) + 31.9*log10(d_3d)
```

**结果**: 完全一致 ✅

### 区域配置对比

| 参数 | 原始环境 | 调整前 | 调整后 |
|------|---------|--------|--------|
| **区域大小** | 25m x 25m | 1000m x 1000m | 25m x 25m ✅ |
| **高度范围** | 1.5m (固定) | 50-200m | 1.5m (固定) ✅ |

---

## 📋 修改文件清单

1. **Environment_marl_indoor.py**
   - `A2GChannels.get_path_loss()`: 使用原始路径损耗公式
   - `Environ.__init__()`: 区域大小改为25m，高度改为1.5m

---

## ✅ 验证结果

### 测试配置
- UAV数量: 6
- RB数量: 10
- 测试轮数: 10
- 功率范围: 0-24 dB

### 测试结果

**SINR统计**:
- 范围: 11.39 dB ~ 64.54 dB
- 平均值: 35.02 dB
- 中位数: 33.20 dB
- 阈值通过率: 100%

**对比原始环境**:
- 原始环境平均值: 40.83 dB
- 当前环境平均值: 35.02 dB
- **差异: 5.81 dB**（可接受）

---

## 🎯 结论

### 调整成功 ✅

1. **SINR水平接近原始环境**
   - 平均值差异仅5.81 dB（可接受）
   - 100%情况达到阈值（与原始环境一致）

2. **路径损耗匹配**
   - 使用相同的路径损耗公式
   - 路径损耗范围与原始环境一致

3. **区域配置匹配**
   - 25m x 25m区域
   - 1.5m高度（匹配原始环境）

### 预期效果

- **训练成功率**: 应该从0%提升到接近原始环境的水平
- **训练稳定性**: SINR高，训练应该更稳定
- **收敛速度**: 应该更快（更多成功经验）

---

## 📝 注意事项

1. **高度固定为1.5m**
   - 匹配原始环境的车辆高度
   - 如果后续需要UAV高度变化，可以调整

2. **路径损耗公式简化**
   - 移除了LoS/NLoS概率模型
   - 使用简单的路径损耗公式
   - 如果需要更真实的A2G模型，可以后续优化

3. **区域大小固定为25m**
   - 匹配原始环境
   - 如果后续需要更大区域，需要重新调整路径损耗公式

---

*调整完成时间: 2025-12-11*  
*建议重新开始训练，预期成功率会大幅提升*

